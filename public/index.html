(`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SouthPack | Business Inventory & Profit Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        body {
            background-color: #f0f7ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .tab {
            transition: all 0.3s ease;
        }
        .tab.active {
            border-bottom: 3px solid #3b82f6;
            color: #1e40af;
            font-weight: 600;
        }
        .card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        .btn {
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        table {
            border-collapse: separate;
            border-spacing: 0;
        }
        th, td {
            padding: 10px;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f3f4f6;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Auth Container -->
    <div id="authContainer" class="container mx-auto px-4 py-8 max-w-md">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-6 text-center">Business Tracker Login</h2>
            
            <div id="loginForm">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                
                <div class="flex flex-col space-y-3">
                    <button id="loginBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                        Login
                    </button>
                    <button id="registerBtn" class="btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
                        Register
                    </button>
                </div>
                
                <div id="authError" class="mt-4 text-red-600 text-sm hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="container mx-auto px-4 py-8 max-w-6xl hidden">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-800 mb-2">SouthPack | Business Inventory & Profit Tracker</h1>
            <p class="text-gray-600">Track sales, returns, and profitability for multiple products</p>
            <div class="mt-2">
                <span id="userEmail" class="text-sm text-gray-600"></span>
                <button id="logoutBtn" class="ml-4 text-sm text-blue-600 hover:text-blue-800">Logout</button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="flex border-b border-gray-200 mb-6">
            <button id="tab-products" class="tab active px-6 py-3 text-gray-700">Products</button>
            <button id="tab-daily" class="tab px-6 py-3 text-gray-700">Daily Records</button>
            <button id="tab-reports" class="tab px-6 py-3 text-gray-700">Reports</button>
        </div>

        <!-- Products Tab -->
        <div id="content-products" class="tab-content animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-blue-800">Product Management</h2>
                <button id="addProductBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    Add New Product
                </button>
            </div>

            <div class="card bg-white rounded-xl p-6 mb-8">
                <div id="productsLoading" class="flex justify-center py-4">
                    <div class="loader"></div>
                    <span>Loading products...</span>
                </div>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="text-left">Product Name</th>
                                <th class="text-right">Cost Price (₱)</th>
                                <th class="text-right">Selling Price (₱)</th>
                                <th class="text-right">Shipping Cost (₱)</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productTableBody">
                            <tr>
                                <td colspan="5" class="text-center text-gray-500">No products added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add/Edit Product Modal -->
            <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl p-6 w-full max-w-md">
                    <h3 id="productModalTitle" class="text-xl font-bold text-blue-800 mb-4">Add New Product</h3>
                    
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="mb-4">
                            <label for="productName" class="block text-sm font-medium text-gray-700 mb-1">Product Name</label>
                            <input type="text" id="productName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="costPrice" class="block text-sm font-medium text-gray-700 mb-1">
                                Cost Price (₱)
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Cost to purchase or produce each item</span>
                                </span>
                            </label>
                            <input type="number" id="costPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="0.01" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="sellingPrice" class="block text-sm font-medium text-gray-700 mb-1">
                                Selling Price (₱)
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Price at which you sell each item</span>
                                </span>
                            </label>
                            <input type="number" id="sellingPrice" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="0.01" required>
                        </div>
                        
                        <div class="mb-6">
                            <label for="shippingCost" class="block text-sm font-medium text-gray-700 mb-1">
                                Shipping Cost (₱)
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Cost to ship each item</span>
                                </span>
                            </label>
                            <input type="number" id="shippingCost" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="0.01" required>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancelProductBtn" class="btn px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Cancel</button>
                            <button type="submit" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Daily Records Tab -->
        <div id="content-daily" class="tab-content hidden animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-blue-800">Daily Sales & Returns</h2>
                <button id="addRecordBtn" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                    Add New Record
                </button>
            </div>

            <div class="card bg-white rounded-xl p-6 mb-8">
                <div id="recordsLoading" class="flex justify-center py-4">
                    <div class="loader"></div>
                    <span>Loading records...</span>
                </div>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th class="text-left">Date</th>
                                <th class="text-left">Product</th>
                                <th class="text-right">Items Sold</th>
                                <th class="text-right">Returns</th>
                                <th class="text-right">Ad Spend (₱)</th>
                                <th class="text-right">Other Costs (₱)</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recordTableBody">
                            <tr>
                                <td colspan="7" class="text-center text-gray-500">No records added yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add/Edit Record Modal -->
            <div id="recordModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                <div class="bg-white rounded-xl p-6 w-full max-w-md">
                    <h3 id="recordModalTitle" class="text-xl font-bold text-blue-800 mb-4">Add Daily Record</h3>
                    
                    <form id="recordForm">
                        <input type="hidden" id="recordId">
                        <div class="mb-4">
                            <label for="recordDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="recordDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="recordProduct" class="block text-sm font-medium text-gray-700 mb-1">Product</label>
                            <select id="recordProduct" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                                <option value="">Select a product</option>
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label for="itemsSold" class="block text-sm font-medium text-gray-700 mb-1">
                                Items Sold
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Total number of items sold on this day</span>
                                </span>
                            </label>
                            <input type="number" id="itemsSold" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="1" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="itemsReturned" class="block text-sm font-medium text-gray-700 mb-1">
    Returns (%)
    <span class="tooltip ml-1 text-gray-500">ⓘ
        <span class="tooltiptext">Percentage of items returned (e.g., enter 10 for 10%)</span>
    </span>
                                Returns
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Number of items returned on this day</span>
                                </span>
                            </label>
                            <input type="number" id="itemsReturned" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="1" required>
                        </div>
                        
                        <div class="mb-4">
                            <label for="adSpend" class="block text-sm font-medium text-gray-700 mb-1">
                                Ad Spend (₱)
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Total advertising spend for this day</span>
                                </span>
                            </label>
                            <input type="number" id="adSpend" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="0.01" required>
                        </div>
                        
                        <div class="mb-6">
                            <label for="otherCosts" class="block text-sm font-medium text-gray-700 mb-1">
                                Other Costs (₱)
                                <span class="tooltip ml-1 text-gray-500">ⓘ
                                    <span class="tooltiptext">Additional costs per delivered item</span>
                                </span>
                            </label>
                            <input type="number" id="otherCosts" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" min="0" step="0.01" required>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button type="button" id="cancelRecordBtn" class="btn px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">Cancel</button>
                            <button type="submit" class="btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Save Record</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="content-reports" class="tab-content hidden animate-fade-in">
            <div id="reportsLoading" class="flex justify-center py-4">
                <div class="loader"></div>
                <span>Loading reports...</span>
            </div>
            
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-800 mb-4">Profit Analysis</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="card bg-white rounded-xl p-4">
                        <p class="text-sm text-gray-600 mb-1">Total Revenue</p>
                        <p id="totalRevenue" class="text-2xl font-bold text-blue-800">₱0.00</p>
                    </div>
                    
                    <div class="card bg-white rounded-xl p-4">
                        <p class="text-sm text-gray-600 mb-1">Total Cost</p>
                        <p id="totalCost" class="text-2xl font-bold text-blue-800">₱0.00</p>
                    </div>
                    
                    <div class="card bg-white rounded-xl p-4">
                        <p class="text-sm text-gray-600 mb-1">Total Profit</p>
                        <p id="totalProfit" class="text-2xl font-bold text-green-700">₱0.00</p>
                    </div>
                </div>
                
                <div class="card bg-white rounded-xl p-6 mb-8">
                    <h3 class="font-bold text-gray-700 mb-4">Daily Performance</h3>
                    <canvas id="dailyChart" height="100"></canvas>
                </div>
            </div>
            
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-800 mb-4">Return Inventory</h2>
                
                <div class="card bg-white rounded-xl p-6">
                    <div class="table-container">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="text-left">Product</th>
                                    <th class="text-right">Total Returns</th>
                                    <th class="text-right">Return Value (₱)</th>
                                </tr>
                            </thead>
                            <tbody id="returnsTableBody">
                                <tr>
                                    <td colspan="3" class="text-center text-gray-500">No returns recorded yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-blue-800 mb-4">Product Performance</h2>
                
                <div class="card bg-white rounded-xl p-6">
                    <div class="table-container">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th class="text-left">Product</th>
                                    <th class="text-right">Items Sold</th>
                                    <th class="text-right">Items Delivered</th>
                                    <th class="text-right">Return Rate</th>
                                    <th class="text-right">Revenue (₱)</th>
                                    <th class="text-right">Profit (₱)</th>
                                    <th class="text-right">Profit Margin</th>
                                </tr>
                            </thead>
                            <tbody id="performanceTableBody">
                                <tr>
                                    <td colspan="7" class="text-center text-gray-500">No data available yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        // REPLACE THIS WITH YOUR FIREBASE CONFIG
        const firebaseConfig = {
  apiKey: "AIzaSyCp8CBLjD3WObto3v9h0WZKHaQxu1ndwbQ",
  authDomain: "southpack-298b9.firebaseapp.com",
  projectId: "southpack-298b9",
  storageBucket: "southpack-298b9.firebasestorage.app",
  messagingSenderId: "285376083565",
  appId: "1:285376083565:web:0ebdb56b77d0fb968bf164",
  measurementId: "G-NYGSRDWCZW"
};
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Firebase Auth and Firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global variables
        let products = [];
        let dailyRecords = [];
        let currentUser = null;
        let dailyChart = null;
        
        // DOM Elements
        const authContainer = document.getElementById('authContainer');
        const appContainer = document.getElementById('appContainer');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userEmail = document.getElementById('userEmail');
        const authError = document.getElementById('authError');
        
        // Auth event listeners
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showAuthError('Please enter both email and password.');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    showAuthError(error.message);
                });
        });
        
        registerBtn.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showAuthError('Please enter both email and password.');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Password should be at least 6 characters.');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .catch(error => {
                    showAuthError(error.message);
                });
        });
        
        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });
        
        function showAuthError(message) {
            authError.textContent = message;
            authError.classList.remove('hidden');
        }
        
        // Auth state change listener
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                currentUser = user;
                userEmail.textContent = user.email;
                
                // Show app, hide auth
                authContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                // Load data
                loadProducts();
                loadDailyRecords();
            } else {
                // User is signed out
                currentUser = null;
                
                // Show auth, hide app
                authContainer.classList.remove('hidden');
                appContainer.classList.add('hidden');
                
                // Clear auth form and error
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                authError.classList.add('hidden');
            }
        });
        
        // Tab Navigation
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Hide all tab contents
                tabContents.forEach(content => content.classList.add('hidden'));
                
                // Show the corresponding tab content
                const contentId = tab.id.replace('tab-', 'content-');
                document.getElementById(contentId).classList.remove('hidden');
                
                // Update reports if reports tab is selected
                if (contentId === 'content-reports') {
                    updateReports();
                }
            });
        });
        
        // Firebase Data Functions
        function loadProducts() {
            if (!currentUser) return;
            
            document.getElementById('productsLoading').classList.remove('hidden');
            
            db.collection('users').doc(currentUser.uid).collection('products')
                .orderBy('name')
                .get()
                .then(snapshot => {
                    products = [];
                    snapshot.forEach(doc => {
                        products.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    updateProductTable();
                    updateProductDropdown();
                    document.getElementById('productsLoading').classList.add('hidden');
                })
                .catch(error => {
                    console.error("Error loading products: ", error);
                    document.getElementById('productsLoading').classList.add('hidden');
                });
        }
        
        function loadDailyRecords() {
            if (!currentUser) return;
            
            document.getElementById('recordsLoading').classList.remove('hidden');
            
            db.collection('users').doc(currentUser.uid).collection('dailyRecords')
                .orderBy('date', 'desc')
                .get()
                .then(snapshot => {
                    dailyRecords = [];
                    snapshot.forEach(doc => {
                        dailyRecords.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    updateRecordTable();
                    document.getElementById('recordsLoading').classList.add('hidden');
                })
                .catch(error => {
                    console.error("Error loading daily records: ", error);
                    document.getElementById('recordsLoading').classList.add('hidden');
                });
        }
        
        // Product Management
        const productModal = document.getElementById('productModal');
        const productForm = document.getElementById('productForm');
        const productTableBody = document.getElementById('productTableBody');
        
        document.getElementById('addProductBtn').addEventListener('click', () => {
            document.getElementById('productModalTitle').textContent = 'Add New Product';
            document.getElementById('productId').value = '';
            productForm.reset();
            productModal.classList.remove('hidden');
        });
        
        document.getElementById('cancelProductBtn').addEventListener('click', () => {
            productModal.classList.add('hidden');
        });
        
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const productId = document.getElementById('productId').value;
            const productName = document.getElementById('productName').value;
            const costPrice = parseFloat(document.getElementById('costPrice').value);
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
            const shippingCost = parseFloat(document.getElementById('shippingCost').value);
            
            const productData = {
                name: productName,
                costPrice,
                sellingPrice,
                shippingCost,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (productId) {
                // Edit existing product
                db.collection('users').doc(currentUser.uid).collection('products').doc(productId)
                    .update(productData)
                    .then(() => {
                        loadProducts();
                        productModal.classList.add('hidden');
                    })
                    .catch(error => {
                        console.error("Error updating product: ", error);
                    });
            } else {
                // Add new product
                productData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                
                db.collection('users').doc(currentUser.uid).collection('products')
                    .add(productData)
                    .then(() => {
                        loadProducts();
                        productModal.classList.add('hidden');
                    })
                    .catch(error => {
                        console.error("Error adding product: ", error);
                    });
            }
        });
        
        function updateProductTable() {
            if (products.length === 0) {
                productTableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-gray-500">No products added yet</td>
                    </tr>
                `;
                return;
            }
            
            productTableBody.innerHTML = '';
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-left">${product.name}</td>
                    <td class="text-right">₱${product.costPrice.toFixed(2)}</td>
                    <td class="text-right">₱${product.sellingPrice.toFixed(2)}</td>
                    <td class="text-right">₱${product.shippingCost.toFixed(2)}</td>
                    <td class="text-center">
                        <button class="edit-product text-blue-600 hover:text-blue-800 mr-2" data-id="${product.id}">Edit</button>
                        <button class="delete-product text-red-600 hover:text-red-800" data-id="${product.id}">Delete</button>
                    </td>
                `;
                productTableBody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-product').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = button.getAttribute('data-id');
                    const product = products.find(p => p.id === productId);
                    
                    if (product) {
                        document.getElementById('productModalTitle').textContent = 'Edit Product';
                        document.getElementById('productId').value = product.id;
                        document.getElementById('productName').value = product.name;
                        document.getElementById('costPrice').value = product.costPrice;
                        document.getElementById('sellingPrice').value = product.sellingPrice;
                        document.getElementById('shippingCost').value = product.shippingCost;
                        
                        productModal.classList.remove('hidden');
                    }
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(button => {
                button.addEventListener('click', () => {
                    const productId = button.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this product? This will also delete all daily records for this product.')) {
                        if (!currentUser) return;
                        
                        // Delete the product
                        db.collection('users').doc(currentUser.uid).collection('products').doc(productId)
                            .delete()
                            .then(() => {
                                // Delete all daily records for this product
                                const batch = db.batch();
                                
                                db.collection('users').doc(currentUser.uid).collection('dailyRecords')
                                    .where('productId', '==', productId)
                                    .get()
                                    .then(snapshot => {
                                        snapshot.forEach(doc => {
                                            batch.delete(doc.ref);
                                        });
                                        
                                        return batch.commit();
                                    })
                                    .then(() => {
                                        loadProducts();
                                        loadDailyRecords();
                                    });
                            })
                            .catch(error => {
                                console.error("Error deleting product: ", error);
                            });
                    }
                });
            });
        }
        
        // Daily Records Management
        const recordModal = document.getElementById('recordModal');
        const recordForm = document.getElementById('recordForm');
        const recordTableBody = document.getElementById('recordTableBody');
        
        document.getElementById('addRecordBtn').addEventListener('click', () => {
            if (products.length === 0) {
                alert('Please add at least one product first.');
                return;
            }
            
            document.getElementById('recordModalTitle').textContent = 'Add Daily Record';
            document.getElementById('recordId').value = '';
            recordForm.reset();
            document.getElementById('recordDate').valueAsDate = new Date();
            recordModal.classList.remove('hidden');
        });
        
        document.getElementById('cancelRecordBtn').addEventListener('click', () => {
            recordModal.classList.add('hidden');
        });
        
        function updateProductDropdown() {
            const dropdown = document.getElementById('recordProduct');
            dropdown.innerHTML = '<option value="">Select a product</option>';
            
            products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                dropdown.appendChild(option);
            });
        }
        
        recordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (!currentUser) return;
            
            const recordId = document.getElementById('recordId').value;
            const date = document.getElementById('recordDate').value;
            const productId = document.getElementById('recordProduct').value;
            const itemsSold = parseInt(document.getElementById('itemsSold').value);
            const returnPercent = parseFloat(document.getElementById('itemsReturned').value);
    const actualReturns = Math.round((returnPercent / 100) * itemsSold);
            const adSpend = parseFloat(document.getElementById('adSpend').value);
            const otherCosts = parseFloat(document.getElementById('otherCosts').value);
            
            const recordData = {
                date,
                productId,
                itemsSold,
                itemsReturned: actualReturns,
                adSpend,
                otherCosts,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (recordId) {
                // Edit existing record
                db.collection('users').doc(currentUser.uid).collection('dailyRecords').doc(recordId)
                    .update(recordData)
                    .then(() => {
                        loadDailyRecords();
                        recordModal.classList.add('hidden');
                    })
                    .catch(error => {
                        console.error("Error updating record: ", error);
                    });
            } else {
                // Add new record
                recordData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                
                db.collection('users').doc(currentUser.uid).collection('dailyRecords')
                    .add(recordData)
                    .then(() => {
                        loadDailyRecords();
                        recordModal.classList.add('hidden');
                    })
                    .catch(error => {
                        console.error("Error adding record: ", error);
                    });
            }
        });
        
        function updateRecordTable() {
            if (dailyRecords.length === 0) {
                recordTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500">No records added yet</td>
                    </tr>
                `;
                return;
            }
            
            recordTableBody.innerHTML = '';
            dailyRecords.forEach(record => {
                const product = products.find(p => p.id === record.productId);
                if (!product) return; // Skip if product was deleted
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-left">${formatDate(record.date)}</td>
                    <td class="text-left">${product.name}</td>
                    <td class="text-right">${record.itemsSold}</td>
                    <td class="text-right">${record.itemsSold > 0 ? ((record.itemsReturned / record.itemsSold) * 100).toFixed(1) + "%" : "0%"}</td>
                    <td class="text-right">₱${record.adSpend.toFixed(2)}</td>
                    <td class="text-right">₱${record.otherCosts.toFixed(2)}</td>
                    <td class="text-center">
                        <button class="edit-record text-blue-600 hover:text-blue-800 mr-2" data-id="${record.id}">Edit</button>
                        <button class="delete-record text-red-600 hover:text-red-800" data-id="${record.id}">Delete</button>
                    </td>
                `;
                recordTableBody.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-record').forEach(button => {
                button.addEventListener('click', () => {
                    const recordId = button.getAttribute('data-id');
                    const record = dailyRecords.find(r => r.id === recordId);
                    
                    if (record) {
                        document.getElementById('recordModalTitle').textContent = 'Edit Daily Record';
                        document.getElementById('recordId').value = record.id;
                        document.getElementById('recordDate').value = record.date;
                        document.getElementById('recordProduct').value = record.productId;
                        document.getElementById('itemsSold').value = record.itemsSold;
                        document.getElementById('itemsReturned').value = record.itemsReturned;
                        document.getElementById('adSpend').value = record.adSpend;
                        document.getElementById('otherCosts').value = record.otherCosts;
                        
                        recordModal.classList.remove('hidden');
                    }
                });
            });
            
            document.querySelectorAll('.delete-record').forEach(button => {
                button.addEventListener('click', () => {
                    const recordId = button.getAttribute('data-id');
                    if (confirm('Are you sure you want to delete this record?')) {
                        if (!currentUser) return;
                        
                        db.collection('users').doc(currentUser.uid).collection('dailyRecords').doc(recordId)
                            .delete()
                            .then(() => {
                                loadDailyRecords();
                            })
                            .catch(error => {
                                console.error("Error deleting record: ", error);
                            });
                    }
                });
            });
        }
        
        // Reports
        function updateReports() {
            document.getElementById('reportsLoading').classList.remove('hidden');
            
            updateProfitAnalysis();
            updateReturnInventory();
            updateProductPerformance();
            updateDailyChart();
            
            document.getElementById('reportsLoading').classList.add('hidden');
        }
        
        function updateProfitAnalysis() {
            let totalRev = 0;
            let totalCst = 0;
            
            dailyRecords.forEach(record => {
                const product = products.find(p => p.id === record.productId);
                if (!product) return; // Skip if product was deleted
                
                const deliveredItems = record.itemsSold - record.itemsReturned;
                
                // Revenue from delivered items
                const revenue = deliveredItems * product.sellingPrice;
                
                // Costs
                const productCost = record.itemsSold * product.costPrice; // Cost for all items
                const shippingCost = record.itemsSold * product.shippingCost; // Shipping for all items
                const otherCost = deliveredItems * record.otherCosts; // Other costs only for delivered items
                const totalCost = productCost + shippingCost + record.adSpend + otherCost;
                
                totalRev += revenue;
                totalCst += totalCost;
            });
            
            const totalPft = totalRev - totalCst;
            
            document.getElementById('totalRevenue').textContent = `₱${totalRev.toFixed(2)}`;
            document.getElementById('totalCost').textContent = `₱${totalCst.toFixed(2)}`;
            
            const profitElement = document.getElementById('totalProfit');
            profitElement.textContent = `₱${totalPft.toFixed(2)}`;
            
            if (totalPft >= 0) {
                profitElement.classList.remove('text-red-700');
                profitElement.classList.add('text-green-700');
            } else {
                profitElement.classList.remove('text-green-700');
                profitElement.classList.add('text-red-700');
            }
        }
        
        function updateReturnInventory() {
            const returnsTableBody = document.getElementById('returnsTableBody');
            
            // Group returns by product
            const returnsByProduct = {};
            
            dailyRecords.forEach(record => {
                if (record.itemsReturned > 0) {
                    if (!returnsByProduct[record.productId]) {
                        returnsByProduct[record.productId] = 0;
                    }
                    returnsByProduct[record.productId] += record.itemsReturned;
                }
            });
            
            if (Object.keys(returnsByProduct).length === 0) {
                returnsTableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-gray-500">No returns recorded yet</td>
                    </tr>
                `;
                return;
            }
            
            returnsTableBody.innerHTML = '';
            Object.entries(returnsByProduct).forEach(([productId, returns]) => {
                const product = products.find(p => p.id === productId);
                if (!product) return; // Skip if product was deleted
                
                const returnValue = returns * product.costPrice;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-left">${product.name}</td>
                    <td class="text-right">${returns}</td>
                    <td class="text-right">₱${returnValue.toFixed(2)}</td>
                `;
                returnsTableBody.appendChild(row);
            });
        }
        
        function updateProductPerformance() {
            const performanceTableBody = document.getElementById('performanceTableBody');
            
            // Group performance by product
            const performanceByProduct = {};
            
            dailyRecords.forEach(record => {
                if (!performanceByProduct[record.productId]) {
                    performanceByProduct[record.productId] = {
                        itemsSold: 0,
                        itemsReturned: 0,
                        revenue: 0,
                        costs: 0,
                        adSpend: 0,
                        otherCosts: 0
                    };
                }
                
                const product = products.find(p => p.id === record.productId);
                if (!product) return; // Skip if product was deleted
                
                const deliveredItems = record.itemsSold - record.itemsReturned;
                
                // Update performance data
                performanceByProduct[record.productId].itemsSold += record.itemsSold;
                performanceByProduct[record.productId].itemsReturned += record.itemsReturned;
                
                // Revenue from delivered items
                const revenue = deliveredItems * product.sellingPrice;
                performanceByProduct[record.productId].revenue += revenue;
                
                // Costs
                const productCost = record.itemsSold * product.costPrice;
                const shippingCost = record.itemsSold * product.shippingCost;
                const otherCost = deliveredItems * record.otherCosts;
                
                performanceByProduct[record.productId].costs += productCost + shippingCost + otherCost;
                performanceByProduct[record.productId].adSpend += record.adSpend;
                performanceByProduct[record.productId].otherCosts += otherCost;
            });
            
            if (Object.keys(performanceByProduct).length === 0) {
                performanceTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-gray-500">No data available yet</td>
                    </tr>
                `;
                return;
            }
            
            performanceTableBody.innerHTML = '';
            Object.entries(performanceByProduct).forEach(([productId, performance]) => {
                const product = products.find(p => p.id === productId);
                if (!product) return; // Skip if product was deleted
                
                const itemsDelivered = performance.itemsSold - performance.itemsReturned;
                const returnRate = performance.itemsSold > 0 ? (performance.itemsReturned / performance.itemsSold) * 100 : 0;
                
                const totalCost = performance.costs + performance.adSpend;
                const profit = performance.revenue - totalCost;
                const profitMargin = performance.revenue > 0 ? (profit / performance.revenue) * 100 : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-left">${product.name}</td>
                    <td class="text-right">${performance.itemsSold}</td>
                    <td class="text-right">${itemsDelivered}</td>
                    <td class="text-right">${returnRate.toFixed(1)}%</td>
                    <td class="text-right">₱${performance.revenue.toFixed(2)}</td>
                    <td class="text-right ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">₱${profit.toFixed(2)}</td>
                    <td class="text-right ${profitMargin >= 0 ? 'text-green-600' : 'text-red-600'}">${profitMargin.toFixed(1)}%</td>
                `;
                performanceTableBody.appendChild(row);
            });
        }
        
        function updateDailyChart() {
            const ctx = document.getElementById('dailyChart').getContext('2d');
            
            // Group data by date
            const dailyData = {};
            
            dailyRecords.forEach(record => {
                const product = products.find(p => p.id === record.productId);
                if (!product) return; // Skip if product was deleted
                
                if (!dailyData[record.date]) {
                    dailyData[record.date] = {
                        revenue: 0,
                        cost: 0
                    };
                }
                
                const deliveredItems = record.itemsSold - record.itemsReturned;
                
                // Revenue from delivered items
                const revenue = deliveredItems * product.sellingPrice;
                
                // Costs
                const productCost = record.itemsSold * product.costPrice;
                const shippingCost = record.itemsSold * product.shippingCost;
                const otherCost = deliveredItems * record.otherCosts;
                const totalCost = productCost + shippingCost + record.adSpend + otherCost;
                
                dailyData[record.date].revenue += revenue;
                dailyData[record.date].cost += totalCost;
            });
            
            // Sort dates
            const sortedDates = Object.keys(dailyData).sort();
            
            const labels = sortedDates.map(date => formatDate(date));
            const revenueData = sortedDates.map(date => dailyData[date].revenue);
            const costData = sortedDates.map(date => dailyData[date].cost);
            const profitData = sortedDates.map(date => dailyData[date].revenue - dailyData[date].cost);
            
            if (dailyChart) {
                dailyChart.destroy();
            }
            
            dailyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Revenue',
                            data: revenueData,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgb(59, 130, 246)',
                            borderWidth: 1
                        },
                        {
                            label: 'Cost',
                            data: costData,
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 1
                        },
                        {
                            label: 'Profit',
                            data: profitData,
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: 'rgb(16, 185, 129)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₱)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        }
                    }
                }
            });
        }
        
        // Helper Functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
    </script>
</body>
</html>`);